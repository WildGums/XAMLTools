<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask TaskName="XAMLTools.MSBuild.XAMLCombineTask" AssemblyFile="$(XAMLToolsAssembly)"/>
  <UsingTask TaskName="XAMLTools.MSBuild.XAMLColorSchemeGeneratorTask" AssemblyFile="$(XAMLToolsAssembly)"/>

  <Target Name="XAMLCombine"
          BeforeTargets="$(XAMLCombineTargetsBefore)"
          DependsOnTargets="$(XAMLCombineDependsOnTargets)"
          Condition="'$(XAMLCombineEnabled)' == 'True' And $(MSBuildProjectName.Contains('_wpftmp')) != 'True'">

    <Error Condition="($(MsBuildMajorVersion) &lt; 16)"
           Text="XAMLTools is only supported on MSBuild 16 and above. Current version: $(MsBuildMajorVersion)."/>

    <XAMLCombineTask Items="@(XAMLCombineItems)">
      <Output ItemName="XAMLCombineWrittenFiles" TaskParameter="WrittenFiles"/>
      <Output ItemName="XAMLCombineNewFiles" TaskParameter="NewFiles"/>
    </XAMLCombineTask>

    <ItemGroup>
      <FileWrites Include="@(XAMLCombineWrittenFiles)"/>
      <Page Include="@(XAMLCombineNewFiles)"/>
    </ItemGroup>
  </Target>

  <ItemGroup>
    <Page Remove="@(XAMLCombineItems)" Condition="'$(RemoveXAMLCombineItemsFromPages)' != 'False'"/>
<!--    <Page Include="@(XAMLCombineItems)" Condition="'$(RemoveXAMLCombineItemsFromPages)' == 'False'"/>-->
  </ItemGroup>

  <Target Name="XAMLColorSchemeGenerator"
          BeforeTargets="$(XAMLToolsXAMLColorSchemeGeneratorTargetsBefore)"
          DependsOnTargets="$(XAMLColorSchemeGeneratorDependsOnTargets)"
          Condition="'$(XAMLColorSchemeGeneratorEnabled)' == 'True' And $(MSBuildProjectName.Contains('_wpftmp')) != 'True'">

    <Error Condition="($(MsBuildMajorVersion) &lt; 16)"
           Text="XAMLTools is only supported on MSBuild 16 and above. Current version: $(MsBuildMajorVersion)."/>

    <XAMLColorSchemeGeneratorTask Items="@(XAMLColorSchemeGeneratorItems)">
      <Output ItemName="XAMLColorSchemeGeneratorWrittenFiles" TaskParameter="WrittenFiles"/>
      <Output ItemName="XAMLColorSchemeGeneratorNewFiles" TaskParameter="NewFiles"/>
    </XAMLColorSchemeGeneratorTask>

    <ItemGroup>
      <FileWrites Include="@(XAMLColorSchemeGeneratorWrittenFiles)"/>
      <Page Include="@(XAMLColorSchemeGeneratorNewFiles)"/>
    </ItemGroup>
  </Target>

  <ItemGroup>
    <Page Remove="@(XAMLColorSchemeGeneratorItems)" Condition="'$(RemoveXAMLColorSchemeGeneratorItemsFromPages)' != 'False'"/>

    <EmbeddedResource Include="@(XAMLColorSchemeGeneratorItems)" Condition="'$(EmbedXAMLColorSchemeGeneratorInputs)' == 'True'"/>
    <EmbeddedResource Include="@(XAMLColorSchemeGeneratorItems->Metadata('ParametersFile'))" Condition="'$(EmbedXAMLColorSchemeGeneratorInputs)' == 'True'"/>

    <UpToDateCheckInput Include="@(XAMLColorSchemeGeneratorItems->Metadata('ParametersFile'))"/>
  </ItemGroup>
</Project>